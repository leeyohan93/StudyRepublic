<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org"
	xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
	layout:decorate="~{/layout/mainLayout}">

<head>
<meta charset="UTF-8">
<title>받은쪽지함</title>
<meta name="viewport"
	content="width=device-width, initial-scale=1, user-scalable=no" />
<link rel="stylesheet" th:href="@{/assets/css/main.css}">
<link rel="stylesheet" th:href="@{/bootstrap/css/bootstrap.min.css}">
<link rel="stylesheet" th:href="@{/datepicker/css/datepicker.css}"
	type="text/css">
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>

<style type="text/css">
	
	.dropdown-toggle::after {
   border: none !important;
}

.messageSelect{
    width: 100px;
    border: 1px solid #ccc;
    border-radius: 4px;
    padding-left: 10px;
    margin-left: 70%;
}


</style>	
	
	
</head>
<body>





<div id="main" layout:fragment="main">
<div class="inner">
<div class="row">

		<nav class="col-sm-3 col-md-2 d-none d-sm-block bg-light sidebar" style="height: 500px;">
				<ul class="nav nav-pills flex-column">
				
					<li class="nav-item">
						<a class="nav-link" href="messageWrite">쪽지쓰기</a>
						<a class="nav-link" href="receiveMessage">받은쪽지함</a>
						<a class="nav-link" href="sendMessage">보낸쪽지함</a>
						
					</li>   	
				</ul>
	</nav>

<div class="row" style="width: 86%">
<div class="col-sm-9">
<h2>받은쪽지함</h2>

<!-- <div th:with="result = ${list.list}"> -->
<form name="checkdelete" id="checkdelete" action = "/receiveCheckdelete">
<div class = "messageBar" style="margin-bottom: 1%;">
<input type="submit" value="삭제"  style="background-color:rgb(179,220,248);"/>
<select class="messageSelect">
	<option value="5" th:selected="${pageDTO.size} == '5'">5개씩 </option>
	<option value="10" th:selected="${pageDTO.size} == '10'">10개씩 </option>
	<option value="15" th:selected="${pageDTO.size} == '15'">15개씩 </option>
</select> 	
</div>

<div  th:with="list=${receiveList.list}">
<table th:inline ="text" class="table" border ="1" th:with="list=${receiveList.list}">
	<tr>
		<!-- <td>번호</td> -->
		<td scope="col"><input class="allCheck" id="allCheck" type="checkbox" /></td>
		<td scope="col">보낸사람</td>
		<td scope="col">내용</td>
		<td scope="col">날짜</td>
	<!-- 	<td scope="col">삭제여부</td> -->
	</tr>
		
	
	<tr th:each = "receive : ${list}">
		<!-- <td th:text=" ${receive.messageReceiveId}"/> -->
		<td class="text_ct">
		<input name="RowCheck" id="RowCheck" class="RowCheck" type="checkbox" th:value="${receive.messageReceiveId}"/></td>
		
		<td> <div class="dropdown">
		   <a class="dropdown-toggle" data-toggle="dropdown" th:text="${receive.sendId}"></a>
		    <div class="dropdown-menu">
		      <a class="dropdown-item" data-toggle="modal" data-target="#messagewrite" th:data-receive-id="${receive.sendId}" >쪽지쓰기</a>
		      <a class="dropdown-item" data-toggle="modal" data-target="#memberinfo" th:data-member-info="${receive.sendId}" >유저정보</a>
	    	</div>
	 </div></td>
		<td><a th:href="@{'/viewReceivemessage/'(messageReceiveId=${receive.messageReceiveId})}" th:text="${receive.messageContent}" ></a></td>
		<td th:text="${receive.messageDate}"/>
	<!-- 	<td th:text="${receive.messageDelete}"/> -->
	</tr>	
</table>	
</div>
</form>
		

	
	<!-- 모달창 쪽지쓰기창 시작 -->   
	 <div class="modal" id="messagewrite">
		      	<div class="modal-dialog">
		      		<div class="modal-content">
		      		
				        <div class="modal-header">
				          <h4 class="modal-title">쪽지쓰기</h4>
				          <button type="button" class="close" data-dismiss="modal">&times;</button>
				        </div>
				        
				        
				        <div class="modal-body">
				          <form method="POST" action="/modalmessageWriteResult" name="modalmessage">
				        <div class="card border-primary rounded-0">
                            <div class="card-header p-0">
                                <div class="bg-info text-white text-center py-2" style="width: 100%;">
                                    <h3><i class="fa fa-envelope"></i> </h3>
                                    <p class="m-0">쪽지쓰기</p>
                                </div>
                            </div>
                            <div class="card-body p-3">

                                <!--Body-->
                                <div class="form-group">
                                    <div class="input-group mb-2">
                                        <div class="input-group-prepend">
                                            <div class="input-group-text" style="border: solid 1px;"><i class="fa fa-user text-info"></i></div>
                                        </div> 
                                        <input type="text" class="form-control" id="receiveId" name="receiveId" placeholder="받는사람을 입력해주세요." value="" required style="margin-left: 1%;
    											border: solid 1px;">
                                    </div>
                                </div>
  
                                <div class="form-group">
                                    <div class="input-group mb-2">
                                        <div class="input-group-prepend" style="border: solid 1px;border-radius: 5px; margin-bottom: 1%;">
                                            <div class="input-group-text"><i class="fa fa-comment text-info"></i></div>
                                        </div>
                                        <div class="textarea-wrapper" style="width: 100%; border:solid 1px; border-radius: 5px;">
                                        <textarea class="form-control" name="messageContent" id="messageContent" placeholder="내용을 입력해주세요."  required></textarea>
                                        </div> 
                                    </div>
                                </div>
                                <div class="text-center" style="width:100%;">
                               	    <input type="hidden" th:name="${_csrf.parameterName}" th:value="${_csrf.token}" /> 
                                    <input type="submit" value="전송하기" class="btn btn-info btn-block rounded-0 py-2" id="gomessage">
                                </div>
                            </div>
                        </div>
                    </form>
				        </div>
				        <div class="modal-footer">
				          <button type="button" class="btn btn-danger" data-dismiss="modal"> Close</button>
				        </div>
		      		</div>
		      	</div>
		      </div>
		      
		      <!-- 모달창 쪽지쓰기창 끝 -->
		      
		      <!-- 모달창 유저정보 시작 -->
				<div class="modal" id="memberinfo">
				  <div class="modal-dialog">
				    <div class="modal-content" style="background-color:white";>
				
				      <!-- Modal Header -->
				      <div class="modal-header">
				        <h4 class="modal-title">회원정보</h4>
				        <button type="button" class="close" data-dismiss="modal">&times;</button>
				      </div>
				
				      <!-- Modal body -->
				      <div class="modal-body2" id="modal_memberInfolist" style="text-align:center;">
				      
				      </div>
				
				      <!-- Modal footer -->
				      <div class="modal-footer">
				        <button type="button" class="btn btn-danger" data-dismiss="modal">Close</button>
				      </div>
				
				    </div>
				  </div>
				</div>
				
				  <!-- 모달창 유저정보 끝 -->
         						

         						
	<nav>
		<div>
			<ul class="pagination">
				<li class="page-item" th:if="${receiveList.prevPage}"><a th:href="${receiveList.prevPage.pageNumber}+ 1">  &nbsp&nbsp이전 </a></li>
				<li class="page-item" th:each="page :${receiveList.pageList}" th:classappend="${page.pageNumber == receiveList.currentPageNum -1}?active: ''"><a th:href="${page.pageNumber} +1" > [[${page.pageNumber} + 1]]</a></li>
				<li class="page-item" th:if="${receiveList.nextPage}"><a th:href="${receiveList.nextPage.pageNumber}+ 1">&nbsp&nbsp다음</a></li>	
				
			</ul>
		</div>
	</nav>


			<form id="pageForm" th:action="@{receiveMessage}" method="get">
					<input type="hidden" name="page" th:value="${receiveList.currentPageNum}">
					<input type="hidden" name="size" th:value="${receiveList.currentPage.pageSize}">
			</form>
			
			<form id="listForm" th:action="@{receiveMessageSelect}" method="get">						
					<input type="hidden" name="listCount" id="listCount">
			</form>
						   




	</div>





</div>

</div>
<script type="text/javascript">

		$(document).ready(function(){
			
			
			 /*페이징*/
			var pageForm = $("#pageForm");
			var listForm = $("#listForm"); 
			 
			$(".pagination a").click(function(e){
			
				e.preventDefault();
				pageForm.find('[name="page"]').val($(this).attr('href'));
				pageForm.submit();
				
			});
			
		/*체크박스 전체선택*/
		$('.allCheck').click(function(){
			$('.RowCheck').prop('checked',this.checked);
		});
			
		/*몇개씩보기 선택*/
		$('.messageSelect').change(function(){
			
			 var listOpt = $(".messageSelect").val();
			 listForm.find("[name='listCount']").val(listOpt);
			 listForm.submit();
		});
		});

		$('#messagewrite').on('show.bs.modal', function(e) {
		    var receiveId = $(e.relatedTarget).data('receive-id');
		    $(e.currentTarget).find('input[name="receiveId"]').val(receiveId);
		});

		$('#memberinfo').on('show.bs.modal', function(e) {
		    var memberInfo = $(e.relatedTarget).data('member-info');
		    $(e.currentTarget).find('input[name="memberInfo"]').val(memberInfo);
		    
		    $.ajax({
		    	url: './modalmember',
		        type: 'GET', 
		        data: {id : memberInfo},
		        datatype: 'JSON',
		        success:function(success){
		        	var mydata = success.memberInfo[0];
		        	var a = '';
		        	/* alert(mydata); */
		        	$("#img_profile").attr('src','/member_image/'+mydata.profileSaveName);
					if(mydata.visibility == 0){ 
						a += '<img id="img_profile" src="/member_image/'+mydata.profileSaveName+'" style="border-radius:100%; width:200px; height:120px;" /><br>'
						a +=  'Member ID :<font id="modal_memberId" name="modal_memberId" >'+mydata.id+'</font><br>'
						a += 'Member Nick Name : <font id="modal_memberNickname" name="modal_memberNickname">'+mydata.nickname+'</font><br>'
						a += '성별 : <font id="modal_memberGender" name="modal_memberGender">'+mydata.gender+'</font><br></div>'
					}else {
						a += '<p>비공개입니다</p>'
						
					}		
					$('.modal-body2').html(a);
						
			
		        },error : function(data, status, err){
		        	
		        	
		        	console.log(status + ":" + err);
		        }
		    });
		 
		});

		$('#gomessage').click(function(){
			
		 	alert("쪽지 전송이 완료되었습니다.")
		});


		
</script>
				


</div>
</div>



</body>
</html>