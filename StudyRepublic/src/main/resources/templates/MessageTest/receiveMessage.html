<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org"
	xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
	layout:decorate="~{/layout/mainLayout}">

<head>
<meta charset="UTF-8">
<title>받은쪽지함</title>
<meta name="viewport"
	content="width=device-width, initial-scale=1, user-scalable=no" />
<link rel="stylesheet" th:href="@{/assets/css/main.css}">
<link rel="stylesheet" th:href="@{/bootstrap/css/bootstrap.min.css}">
<link rel="stylesheet" th:href="@{/datepicker/css/datepicker.css}"
	type="text/css">
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>

<style type="text/css">
	
	.dropdown-toggle::after {
   border: none !important;
}

</style>	
	
	
</head>
<body>





<div id="main" layout:fragment="main">
<div class="inner">
<div class="row">

		<nav class="col-sm-3 col-md-2 d-none d-sm-block bg-light sidebar" style="height: 500px;">
				<ul class="nav nav-pills flex-column">
				
					<li class="nav-item">
						<a class="nav-link" href="messageWrite">쪽지쓰기</a>
						<a class="nav-link" href="receiveMessage">받은쪽지함</a>
						<a class="nav-link" href="sendMessage">보낸쪽지함</a>
						
					</li>   	
				</ul>
	</nav>

<div class="row" style="width: 86%">
<div class="col-sm-9">
<h2>받은쪽지함</h2>

<!-- <div th:with="result = ${list.list}"> -->
<form name="checkdelete" id="checkdelete" action = "/receiveCheckdelete">
<input type="submit" value="삭제"/>
<select class="messageSelect">
	<option value="5" th:selected="${pageDTO.size} == '5'">5개씩 보기</option>
	<option value="10" th:selected="${pageDTO.size} == '10'">10개씩 보기</option>
	<option value="15" th:selected="${pageDTO.size} == '15'">15개씩 보기</option>
</select> 	

<div  th:with="list=${receiveList.list}">
<table th:inline ="text" class="table" border ="1" th:with="list=${receiveList.list}">
	<tr>
		<!-- <td>번호</td> -->
		<td scope="col"><input class="allCheck" id="allCheck" type="checkbox" /></td>
		<td scope="col">보낸사람</td>
		<td scope="col">내용</td>
		<td scope="col">날짜</td>
		<td scope="col">삭제여부</td>
	</tr>
		
	
	<tr th:each = "receive : ${list}">
		<!-- <td th:text=" ${receive.messageReceiveId}"/> -->
		<td class="text_ct">
		<input name="RowCheck" id="RowCheck" class="RowCheck" type="checkbox" th:value="${receive.messageReceiveId}"/></td>
		<td> <div class="dropdown">
		   <a class="dropdown-toggle" data-toggle="dropdown" th:text="${receive.sendId}"></a>
		    <div class="dropdown-menu">
		      <a class="dropdown-item" data-toggle="modal" data-target="#messagewrite" th:data-receive-id="${receive.sendId}" >쪽지쓰기</a>
		      <a class="dropdown-item" data-toggle="modal" data-target="#memberinfo" th:data-member-info="${receive.sendId}" >유저정보</a>
	    	</div>
			 </div></td>	
		<td><a th:href="@{'/viewReceivemessage/'(messageReceiveId=${receive.messageReceiveId})}" th:text="${receive.messageContent}" ></a></td>
		<td th:text="${receive.messageDate}"/>
		<td th:text="${receive.messageDelete}"/>
	</tr>	
</table>	
</div>
</form>
		
		   	
		      
		  
		    
		     
      		 		
		     
			  	

<!-- 모달창 시작 -->
			  <!-- 모달창 쪽지쓰기창 시작 -->   
	 <div class="modal" id="messagewrite">
		      	<div class="modal-dialog">
		      		<div class="modal-content">
		      		
				        <div class="modal-header">
				          <h4 class="modal-title">쪽지쓰기</h4>
				          <button type="button" class="close" data-dismiss="modal">&times;</button>
				        </div>
				        
				        
				        <div class="modal-body">
				          <form method="POST" action="/modalmessageWriteResult" name="modalmessage">
                        <div class="card border-primary rounded-0">
                            <div class="card-header p-0">
                                <div class="bg-info text-white text-center py-2">
                                    <h3><i class="fa fa-envelope"></i> </h3>
                                    <p class="m-0">쪽지쓰기</p>
                                </div>
                            </div>
                            <div class="card-body p-3">

                               
                                <div class="form-group">
                                    <div class="input-group mb-2">
                                        <div class="input-group-prepend">
                                            <div class="input-group-text"><i class="fa fa-user text-info"></i></div>
                                        </div>
                                       <input type="text" class="form-control" id="receiveId" name="receiveId" placeholder="받는사람을 입력해주세요." value="" required/>
                                    </div>
                                </div>
                                
                                <div class="form-group">
                                    <div class="input-group mb-2">
                                        <div class="input-group-prepend">
                                            <div class="input-group-text"><i class="fa fa-comment text-info"></i></div>
                                        </div> 
                                        <textarea class="form-control" name="messageContent" id="messageContent" placeholder="내용을 입력해주세요." required></textarea>
                                    </div>
                                </div>

                                <div class="text-center">
                               	    <input type="hidden" th:name="${_csrf.parameterName}" th:value="${_csrf.token}" /> 
                                    <input type="button" value="전송하기" class="btn btn-info btn-block rounded-0 py-2" onclick ="gomessage()">
                                </div>
         						 <span><a class="btn btn-info btn-block rounded-0 py-2" id="modimember" th:href="@{receiveMessage}" role="button">취소</a></span>
                                        
                                 
                            </div>

                        </div>
                    </form>
				        </div>
				        
				  
				        <div class="modal-footer">
				          <button type="button" class="btn btn-danger" data-dismiss="modal">Close</button>
				        </div>
						      		
		      		
		      		</div>
		      	</div>
		      </div>
		      
		      <!-- 모달창 쪽지쓰기창 끝 -->
		       <!-- 모달창 완료 메세지 -->
		      <div class="modal" id="completemessage">
		    
    			<div class="modal-dialog modal-sm">
      				<div class="modal-content">
      
			        <!-- Modal body -->
			        <div class="modal-body">
			         	쪽지가 전송되었습니다.
			        </div>
			        <!-- Modal footer -->
			        <div class="modal-footer">
			          <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
			        </div>
			      </div>
			    </div>
			  </div>
      
        
        
        
		      
		      <!-- 모달창 유저정보 시작 -->
				<div class="modal" id="memberinfo">
				  <div class="modal-dialog">
				    <div class="modal-content" style="background-color:white";>
				
				      <!-- Modal Header -->
				      <div class="modal-header">
				        <h4 class="modal-title">Modal Heading</h4>
				        <button type="button" class="close" data-dismiss="modal">&times;</button>
				      </div>
				
				      <!-- Modal body -->
				      <div class="modal-body">
				       <input type="text" id="memberInfo" name="memberInfo" value=>
				      
				       </div>
				
				      <!-- Modal footer -->
				      <div class="modal-footer">
				        <button type="button" class="btn btn-danger" data-dismiss="modal">Close</button>
				      </div>
				
				    </div>
				  </div>
				</div>
				
				  <!-- 모달창 유저정보 끝 -->
			  
		
<!-- 모달창 끝 -->
	
	<nav>
		<div>
			<ul class="pagination">
				<li class="page-item" th:if="${receiveList.prevPage}"><a th:href="${receiveList.prevPage.pageNumber}+ 1">  &nbsp&nbsp이전 </a></li>
				<li class="page-item" th:each="page :${receiveList.pageList}" th:classappend="${page.pageNumber == receiveList.currentPageNum -1}?active: ''"><a th:href="${page.pageNumber} +1" > [[${page.pageNumber} + 1]]</a></li>
				<li class="page-item" th:if="${receiveList.nextPage}"><a th:href="${receiveList.nextPage.pageNumber}+ 1">&nbsp&nbsp다음</a></li>	
				
			</ul>
		</div>
	</nav>


			<form id="pageForm" th:action="@{receiveMessage}" method="get">
					<input type="hidden" name="page" th:value="${receiveList.currentPageNum}">
					<input type="hidden" name="size" th:value="${receiveList.currentPage.pageSize}">
			</form>
			
			<form id="listForm" th:action="@{receiveMessageSelect}" method="get">						
					<input type="hidden" name="listCount" id="listCount">
			</form>
						   




	</div>
<!-- 받은쪽지함 테이블  -->




</div>

</div>

<script type="text/javascript">
	$(document).ready(function(){
		
		
		 /*페이징*/
		var pageForm = $("#pageForm");
		var listForm = $("#listForm"); 
		 
		$(".pagination a").click(function(e){
		
			e.preventDefault();
			pageForm.find('[name="page"]').val($(this).attr('href'));
			pageForm.submit();
			
		});
		
     /*체크박스 전체선택*/
	$('.allCheck').click(function(){
		$('.RowCheck').prop('checked',this.checked);
		
	});
	 /*몇개씩보기 선택*/
	 $('.messageSelect').change(function(){
		
		 var listOpt = $(".messageSelect").val();
		 listForm.find("[name='listCount']").val(listOpt);
		 listForm.submit();
	 });
	 

	});
	 $('#messagewrite').on('show.bs.modal', function(e) {
		
	     var receiveId = $(e.relatedTarget).data('receive-id');
	     $(e.currentTarget).find('input[name="receiveId"]').val(receiveId);
	 });
	 
	 



	 
		
		
</script>

</div>
</div>



</body>
</html>