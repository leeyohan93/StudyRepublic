<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org"
xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
layout:decorate="~{/layout/mainLayout}"><head>
<meta charset="UTF-8">
<title>스터디 가입</title>
</head>

<th:block layout:fragment="customCss">
	<style>
	
/* 	.leveltest-container { */
/* 		padding: 0.3rem; */
/* 		background-color: silver;	 */
/* 	} */
	
/* 	.leveltest { */
/* 		opacity: 0.4 !important; */
/* 		border-radius: 22.37%; */
/* 	} */
	
	
        /********************************** leveltest - CSS 시작 **********************************/
        #leveltestArea .leveltest-container {
            width: 100%;
            float: left;
			/* padding-bottom: 100px; */
            /* 참고:  https://stackoverflow.com/a/34471088 */
            /* 문제:  .leveltest-toggle 을 더블클릭하면 컨테이너 내부의 텍스트가 셀렉트 되는 문제 발생 */
            /* 해결:  아래의 스타일을 추가함. (본문 4줄에 해당하는 내용) */
            /* 한계:  텍스트를 셀렉트 해야 할 경우에도 선택되지 않는 경우를 고려해보았으나, 어차피 sortable 적용으로 인해 선택이 불가하며 레벨테스트 취지에도 맞지 않으므로 아래처럼 적용하기로 함. */
            /* 추가:  $(".leveltest-container").on('dbclick', function(e) { e.preventDefault(); return false; }); 처럼 script 단에서 처리하는 방법도 있음. */
            -moz-user-select: none;
            -webkit-user-select: none;
            -ms-user-select: none;
            user-select: none;
            display: block;
            margin-top: 2em;
            border: solid 1px silver;
            padding: 0.1em;
            min-height: 400px;
        }

        #leveltestArea .leveltest {
            margin: 0 0 0.5em 0;
            padding: 0.3em;
            border: 1px solid #c5c5c5;
            border-radius: 3px;
            background-color: white;
        }

        #leveltestArea .leveltest-placeholder {
/*             border: 1px dotted black; */
            margin: 0 0 1em 0;
            height: 50px;
            
        }

        #leveltestArea input {
            background-color: transparent;
            border: dotted 1px;
            display: inline-block;
            height: 1.8em;
        }

        #leveltestArea input.question-content {
            vertical-align: middle;
        }

        #leveltestArea input.question-edit {
            width: 84%;
            font-size: 0.95rem;
        }

        #leveltestArea input.question-choice-group {
            margin-bottom: 0.3rem !important;
        }

        #leveltestArea input.question-choice-option {
            width: 80%;
            height: 1.6em;
            font-size: 0.85rem;
        }

        #leveltestArea .question {
            padding: 0.2em 0.3em;
            margin-bottom: 0.5em;
            position: relative;
            border: 1px solid #dddddd;
            background: #e9e9e9;
            color: #333333;
            font-weight: bold;
        }

        #leveltestArea .question-numbering {
            display: inline-block;
            vertical-align: top;
            height: 100%;
            border: none;
            width: 1.3em;
            font-weight: bolder;
            font-size: 1.3rem;
        }

        #leveltestArea .question-content {
            display: inline-block;
            width: 80%;
            margin-right: 20px;
            padding-block-end: 1px;
            padding-block-start: 1px;
            padding-bottom: 1px;
            padding-top: 1px;
        }

        #leveltestArea .question-edit {
            font-family: "Malgun Gothic";
            font-size: 1rem;
            color: #333333;
            font-weight: bold;
        }

        #leveltestArea .leveltest-toggle {
            position: absolute;
            top: 1rem;
            right: 0;
            transform: translateY(-60%);
        }

        #leveltestArea .icon-minus::before {
            content: "\f068";
            font-family: "Font Awesome 5 Free";
            font-weight: 600;
            color: black;
            width: 100%;
            padding: 0.2em 0.3em;
        }

        #leveltestArea .icon-plus::before {
            content: "\f067";
            font-family: "Font Awesome 5 Free";
            font-weight: 600;
            color: black;
            width: 100%;
            padding: 0.2em 0.3em;
        }

        #leveltestArea .question-choice {
            padding: 0.4em;
        }

        #leveltestArea .choice-numbering {
            margin-right: 0.5rem;
            margin-left: 1rem;
        }

        #leveltestArea .choice-numbering:after {
            content: ")";
        }

        #leveltestArea .icon-remove {
            display: none;
        }

        #leveltestArea .icon-remove:hover {
            cursor: pointer;
        }

        #leveltestArea .icon-remove:after {
            content: "\F00D";
            font-family: "Font Awesome 5 Free";
            font-weight: 600;
            color: black;
            font-size: 0.8rem;
            vertical-align: middle;
            margin-left: 5px;
        }

        #leveltestArea .question-choice-placeholder {
            border-radius: 10px;
            background-color: grey;
            margin-left: 2rem;
            padding: 0.2rem 0.7rem;
            width: auto;
            display: inline-block;
            vertical-align: middle;
            font-size: 0.7em;
            font-weight: bold;
            color: white;
        }

        #leveltestArea .question-answer {
            font-size: 0.9em;
            margin-left: 1em;
        }

        #leveltestArea .question-choice~.question-answer {
            margin-left: 70%;
        }

        #leveltestArea input.question-answer-input {
            width: 80%;
            margin-left: 0.25em;
        }

        #leveltestArea select {
            width: 4rem;
            margin-left: 10px;
        }

        #leveltestArea .inline-block {
            display: inline-block;
        }

        /********************************** leveltest - CSS 끝 **********************************/
        
	
	</style>
	
    <!-- Font Awesome -->
    <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.7.1/css/all.css" integrity="sha384-fnmOCqbTlWIlj8LyTjo7mOUStjsKC4pOpQbqyi7RrhN7udi9RwhKkMHpvLbHG9Sr" crossorigin="anonymous">
	
	<!-- Sortable (for leveltest) -->
    <script src="https://code.jquery.com/jquery-1.12.4.js"></script>
    <script src="https://code.jquery.com/ui/1.12.1/jquery-ui.js"></script>
	
</th:block>

<body>


	<div layout:fragment="main">
		<div class="inner">
		
			<div class="page-header">
				<div class="page-title">
					<h4>레벨테스트</h4>
					<hr>
				</div>
				<div class="page-description">
					<pre>
					-	신청하신 스터디에는 레벨테스트가 등록되어 있습니다.
					-	레벨테스트 응시는 선택사항입니다.
					-	응시 결과는 리더가 가입 승인을 검토할 때 참고 자료로 사용됩니다.
					</pre>			
				</div>
			</div>
			
			<div class="page-content" id="leveltestArea">
				
				<form id="leveltest-submit-form">
	        		<input type='hidden' th:name='${_csrf.parameterName}' th:value='${_csrf.token}' />
				
		            <div class="leveltest-container">
		            
		            	<!-- 값이 공통으로 들어가는지 확인할 것 -->
		            	<input type="hidden" name="studyId" th:value="${studyId}">
		            	<input type="hidden" name="id" th:value="${id}">
		            
			            <th:block th:each="leveltest : ${leveltestList}">	
			       		        <input type="hidden" name="leveltestId" th:value="${leveltest.leveltestId}">
			            
			            
<!-- 			            	<th:block th:if="${leveltest.leveltestTypeCode.leveltestTypeCode} == 'MC'"> -->
					            <div class="leveltest" th:if="${leveltest.leveltestTypeCode.leveltestTypeCode} == 'MC'">
					                <div class="question">
					                    <span class="numbering question-numbering" th:text="${leveltest.questionNumber}">number</span>
					                    <span class="question-content" th:text="${leveltest.content}">content</span>
					                    <span class='icon icon-plus leveltest-toggle'></span>
					                </div>
					                
					                <!-- 참고:  https://bestcure.tistory.com/entry/thymeleaf-each-%EB%AC%B8-%EC%95%88%EC%97%90%EC%84%9C-split%EC%9C%BC%EB%A1%9C-%ED%95%9C%EB%B2%88%EB%8D%94-each-%EC%98%88%EC%A0%9C -->
					                <div class="question-choice" style="display: none" th:each="choice : ${#strings.arraySplit(leveltest.choice, ';')}">
					                
					                    <div class="question-choice-group">
					                        <span class="numbering choice-numbering" th:text="${choiceStat.index} + 1">0</span>
					                        <span class="question-choice-option" th:text="${choice}">choice</span>
					                    </div>
					                    
					                </div>
					                
					                <div class="question-answer" style="display: none">
					                    	정답: <select name="submitAnswer">
					                        <option th:each="choice : ${#strings.arraySplit(leveltest.choice, ';')}" th:value="${choiceStat.index} + 1" th:text="${choiceStat.index} + 1">0</option>
					                    </select>
					                </div>
					            </div>
<!-- 							</th:block> -->
							
<!-- 			           		<th:block th:if="${leveltest.leveltestTypeCode.leveltestTypeCode} == 'SA'"> -->
		                        <div class="leveltest" th:if="${leveltest.leveltestTypeCode.leveltestTypeCode} == 'SA'">
		                            <div class="question">
		                                <span class="numbering question-numbering" th:text="${leveltest.questionNumber}">0</span>
		                                <span class="question-content" th:text="${leveltest.content}">content</span>
		                                <span class="icon icon-plus leveltest-toggle"></span>
		                            </div>
		                            <div class="question-answer" style="display: none">
										정답: <input name="submitAnswer" class="question-answer-input" type="text">
		                            </div>
		
		                        </div>
							
<!-- 							</th:block> -->
						
						</th:block>
						
					</div>
					
					<input class="input-btn" type="reset" value="다시 작성하기">
					<input class="input-btn" type="submit" value="제출하기">
					<input class="input-btn" type="submit" value="건너뛰기">
					
				</form>
					
			</div>
			
		</div>
	</div>

	<th:block layout:fragment="customScript">
		<script type="text/javascript">
		
			$(document).ready(function() {
				
				enableToggle;
				submitForm();
				
			});
			
			

	        function enableToggle() {
	
	            // 참고:  https://stackoverflow.com/a/40949843, https://stackoverflow.com/a/9331127, https://codepedia.info/click-event-for-dynamic-button-jquery/
	            // 원본:  $(".leveltest-toggle").on( "click", function() {
	            // 문제:  맨 마지막에 추가되는 요소의 인덱스를 기준으로, 짝/홀수의 요소만 토글되는 에러 발생.
	            // 원인:  DOM 에 새로 추가되는 요소에는 이벤트가 적용되지 않아 발생한 내부적인 에러로 추정. 이벤트가 발생하는 모든 요소를 감싸는 부모 요소에 이벤트를 등록하면 해결된다고 한다. (ex. document, body 등)
	            // 해결:  코드를 아래처럼 변경함. (1줄에 해당)
	            $(".leveltest-container").on("click", ".leveltest-toggle", function () {
	
	                    console.log('Entered enableToggle()...');
	
	                    var icon = $(this);
	                    var $qContent = icon.siblings(".question-content");
	                    var $qEdit = icon.siblings(".question-edit");
	                    var text = "";
	
	                    icon.toggleClass("icon-plus icon-minus");
	                    icon.closest(".leveltest").find(".question-choice, .question-answer").toggle();
	
	                    if ($qContent.css('display') != 'none') {
	                        text = $qContent.text();
	                        $qEdit.val(text);
	
	                    } else {
	                        text = $qEdit.val();
	                        $qContent.text(text);
	                    }
	
	                    $qContent.toggle();
	                    $qEdit.toggle();
	                });
	        }
	            
	            
	        function submitForm() {
	        	
				$('.input-btn').on('click', "[type='submit']", function(e) {
					
					e.preventDefault();
					
					if($(this).val() == "건너뛰기") {
						
						$('.leveltest-container').remove();						
					}
					
	                $("form").attr("action", "/study/join/" + $("input[name='studyId']").val());
	                $("form").attr("method", "post");
	                $("form").submit();
					
				});
				
	            $(".leveltest-container").on("click", ".leveltest-toggle", function () {
	
	                    var icon = $(this);
	
	                    icon.toggleClass("icon-plus icon-minus");
	                    icon.closest(".leveltest").find(".question-choice, .question-answer").toggle();
	
                });
	        
	        }
	
			
		
		</script>
	</th:block>
</body>
</html>